<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Foro Acad√©mico | UPEC</title>
  <link rel="stylesheet" href="../css/foro.css">
</head>
<body>
  <header>
    <h1>üíª Foro Acad√©mico de Computaci√≥n - UPEC</h1>
    <button id="volverBtn">‚¨Ö Volver al inicio</button>
  </header>

  <main>
    <div class="nuevo-comentario">
      <h2>Publicar nuevo tema o comentario</h2>
      <textarea id="comentarioTexto" placeholder="Escribe tu comentario o pregunta sobre la carrera de Computaci√≥n..."></textarea>
      <button id="publicarBtn">Publicar</button>
    </div>

    <div class="foro-lista">
      <h2>Comentarios Recientes</h2>
      <div id="comentariosContainer"></div>
    </div>
  </main>

  <script>
    const usuarioActivo = localStorage.getItem("usuarioActivo");
    const comentariosContainer = document.getElementById("comentariosContainer");
    const publicarBtn = document.getElementById("publicarBtn");
    const comentarioTexto = document.getElementById("comentarioTexto");
    const volverBtn = document.getElementById("volverBtn");

    volverBtn.addEventListener("click", () => {
      window.location.href = "../inicio.html";
    });

    // Cargar comentarios guardados
    let comentarios = JSON.parse(localStorage.getItem("foroComentarios")) || [];

    function mostrarComentarios() {
      comentariosContainer.innerHTML = "";

      if (comentarios.length === 0) {
        comentariosContainer.innerHTML = "<p>No hay comentarios a√∫n. ¬°S√© el primero en participar!</p>";
        return;
      }

      comentarios.forEach((comentario, index) => {
        const div = document.createElement("div");
        div.classList.add("comentario");

        div.innerHTML = `
          <div class="info-usuario">
            <strong>${comentario.usuario}</strong> <span>${comentario.fecha}</span>
          </div>
          <p>${comentario.texto}</p>
          <div class="acciones">
            <button class="likeBtn" data-index="${index}">üëç ${comentario.likes}</button>
            <button class="deleteBtn" data-index="${index}">üóë Eliminar</button>
          </div>
        `;

        comentariosContainer.appendChild(div);
      });

      document.querySelectorAll(".likeBtn").forEach(btn => {
        btn.addEventListener("click", (e) => {
          const i = e.target.getAttribute("data-index");
          comentarios[i].likes++;
          localStorage.setItem("foroComentarios", JSON.stringify(comentarios));
          mostrarComentarios();
        });
      });

      document.querySelectorAll(".deleteBtn").forEach(btn => {
        btn.addEventListener("click", (e) => {
          const i = e.target.getAttribute("data-index");
          if (comentarios[i].usuario === usuarioActivo) {
            comentarios.splice(i, 1);
            localStorage.setItem("foroComentarios", JSON.stringify(comentarios));
            mostrarComentarios();
          } else {
            alert("Solo puedes eliminar tus propios comentarios.");
          }
        });
      });
    }

    mostrarComentarios();

    publicarBtn.addEventListener("click", () => {
      if (!usuarioActivo) {
        alert("‚ö†Ô∏è Debes iniciar sesi√≥n para comentar.");
        return;
      }

      const texto = comentarioTexto.value.trim();
      if (texto === "") {
        alert("Por favor escribe algo antes de publicar.");
        return;
      }

      const nuevoComentario = {
        usuario: usuarioActivo,
        texto,
        fecha: new Date().toLocaleString(),
        likes: 0
      };

      comentarios.unshift(nuevoComentario);
      localStorage.setItem("foroComentarios", JSON.stringify(comentarios));

      comentarioTexto.value = "";
      mostrarComentarios();
    });
  </script>
</body>
</html>
